# ğŸ“Œ ì—ë„ˆì§€ ì‹œë®¬ë ˆì´ì…˜ í†µí•© ë²„ì „

# 1ï¸âƒ£ ê¸°ë³¸ ì„¤ì •
hours = [0, 3, 6, 9, 12, 15, 18, 21]
base_demand = [50, 48, 55, 70, 90, 88, 75, 60]
LCOE_solar, LCOE_wind, LCOE_nuclear, LCOE_storage = 40, 35, 50, 10
nuclear_output = 35  # ì›ìë ¥ ê³ ì •
storage_capacity = 50
storage = 0

# 2ï¸âƒ£ ì‹œë‚˜ë¦¬ì˜¤ ì •ì˜
def get_scenario_data(name):
    if name == "ë§‘ì€ ë‚ ":
        return [25]*8, [0 if h < 6 or h > 18 else 800 for h in hours], [4]*8, [20]*8, ["ë§‘ìŒ"]*8, base_demand
    elif name == "í­í’ìš°":
        return [20]*8, [0]*8, [12]*8, [80]*8, ["ë¹„"]*8, base_demand
    elif name == "ì—ë„ˆì§€ ê³µê¸‰ ì·¨ì•½":
        return [32]*8, [100]*8, [3.2]*8, [120]*8, ["íë¦¼"]*8, [int(d*1.4) for d in base_demand]
    elif name == "íë¦° ë‚ ":
        return [18]*8, [0 if h < 6 or h > 18 else 300 for h in hours], [4]*8, [50]*8, ["íë¦¼"]*8, base_demand
    elif name == "ëˆˆ ë‚´ë¦¬ëŠ” ë‚ ":
        return [-2]*8, [0 if h < 6 or h > 18 else 100 for h in hours], [7]*8, [30]*8, ["íë¦¼"]*8, [int(d*1.1) for d in base_demand]
    else:
        return get_weather_data() + (base_demand,)

# 3ï¸âƒ£ ì‚¬ìš©ì ì…ë ¥
def get_weather_data():
    print("\nğŸ“Š ì‚¬ìš©ì ì…ë ¥ - ê¸°ìƒ ë°ì´í„° (ê° 8ê°œ ê°’ ì…ë ¥)")
    try:
        temp = list(map(float, input("ğŸŒ¡ï¸ ê¸°ì˜¨(Â°C):\nğŸ‘‰ ").split()))
        solar = list(map(float, input("â˜€ï¸ ì¼ì‚¬ëŸ‰(W/mÂ²):\nğŸ‘‰ ").split()))
        wind = list(map(float, input("ğŸ’¨ í’ì†(m/s):\nğŸ‘‰ ").split()))
        pm25 = list(map(float, input("ğŸŒ«ï¸ ë¯¸ì„¸ë¨¼ì§€(PM2.5):\nğŸ‘‰ ").split()))
        weather = input("ğŸŒ¦ï¸ ë‚ ì”¨ ìƒíƒœ (ì˜ˆ: ë§‘ìŒ íë¦¼ ë¹„ ...):\nğŸ‘‰ ").split()
        if any(len(lst) != 8 for lst in [temp, solar, wind, pm25]) or len(weather) != 8:
            raise ValueError
    except ValueError:
        print("âš  ì…ë ¥ ì˜¤ë¥˜! ê¸°ë³¸ê°’ ì‚¬ìš©")
        temp = [15] * 8
        solar = [0 if h < 6 or h > 18 else 500 for h in hours]
        wind = [5] * 8
        pm25 = [30] * 8
        weather = ["ë§‘ìŒ"] * 8
    return temp, solar, wind, pm25, weather

# 4ï¸âƒ£ ë°œì „ëŸ‰ ê³„ì‚° ê´€ë ¨ í•¨ìˆ˜
def calculate_pm25_impact(pm25): return max(0.5, 1 - 0.005 * (pm25 / 10))
weather_impact = {"ë§‘ìŒ": 1.0, "íë¦¼": 0.75, "ë¹„": 0.5}

def calculate_renewable_energy(temp, solar_rad, wind_speed, pm25, weather):
    solar, wind = [], []
    for i in range(8):
        base = max(0, (solar_rad[i] / 1000) * 50 * (1 - 0.005 * (temp[i] - 25)))
        eff = calculate_pm25_impact(pm25[i]) * weather_impact.get(weather[i], 1.0)
        solar.append(base * eff)
        wind.append(0 if wind_speed[i] < 3 or wind_speed[i] > 25 else 30 * (wind_speed[i] / 10) ** 3)
    return solar, wind

# 5ï¸âƒ£ ì—ë„ˆì§€ ë¯¹ìŠ¤ ìµœì í™”
def optimize_energy_mix(solar, wind, demand):
    global storage
    optimized_solar, optimized_wind, storage_usage = [], [], []
    total_cost = 0
    for i in range(8):
        required = demand[i] - nuclear_output
        available = solar[i] + wind[i]
        if available < required:
            used = min(storage, required - available)
            storage -= used
            storage_usage.append(used)
        else:
            surplus = available - required
            if storage + surplus <= storage_capacity:
                storage += surplus
            else:
                surplus -= (storage_capacity - storage)
                storage = storage_capacity
            ratio_s = solar[i] / available if available else 0
            ratio_w = wind[i] / available if available else 0
            solar[i] -= surplus * ratio_s
            wind[i] -= surplus * ratio_w
            storage_usage.append(0)
        optimized_solar.append(solar[i])
        optimized_wind.append(wind[i])
        total_cost += (solar[i] * LCOE_solar) + (wind[i] * LCOE_wind) + (nuclear_output * LCOE_nuclear) + (storage_usage[i] * LCOE_storage)
    return optimized_solar, optimized_wind, total_cost

# 6ï¸âƒ£ ì‹¤í–‰
print("\nğŸŒ ì‹œë‚˜ë¦¬ì˜¤ë¥¼ ì„ íƒí•˜ì„¸ìš”:")
scenarios = ["ë§‘ì€ ë‚ ", "í­í’ìš°", "ì—ë„ˆì§€ ê³µê¸‰ ì·¨ì•½", "íë¦° ë‚ ", "ëˆˆ ë‚´ë¦¬ëŠ” ë‚ "]
for idx, name in enumerate(scenarios, 1):
    print(f"{idx}. {name}")
print("ì…ë ¥: ì‚¬ìš©ì ì •ì˜")
choice = input("\nğŸ‘‰ ì„ íƒ (1~5/ì…ë ¥): ")

if choice in [str(i) for i in range(1, 6)]:
    temp, solar_rad, wind_spd, pm25, weather, demand = get_scenario_data(scenarios[int(choice)-1])
else:
    temp, solar_rad, wind_spd, pm25, weather = get_weather_data()
    demand = base_demand

solar_gen, wind_gen = calculate_renewable_energy(temp, solar_rad, wind_spd, pm25, weather)
solar_opt, wind_opt, cost_opt = optimize_energy_mix(solar_gen, wind_gen, demand)

# ğŸ”Ÿ ê²°ê³¼ ì¶œë ¥
print("\nâš¡ ìµœì  ì—ë„ˆì§€ ì¡°í•© (3ì‹œê°„ ê°„ê²©) âš¡")
for i in range(8):
    total = solar_opt[i] + wind_opt[i] + nuclear_output
    print(f"{hours[i]:02d}ì‹œ - íƒœì–‘ê´‘: {solar_opt[i]:.1f}MW, í’ë ¥: {wind_opt[i]:.1f}MW, ì›ìë ¥: {nuclear_output:.1f}MW, ì´: {total:.1f}MW")
print(f"\nğŸ’° ì´ ë°œì „ ë¹„ìš©: {cost_opt:,.0f} ì›")
